# 手机屏幕替换工具

## 项目描述

这个Python工具允许您将App截图无缝替换到手机模板图片上，创建出专业级的展示效果。它使用透视变换来确保App截图正确地适应手机屏幕的角度和形状，无论手机在模板图片中的位置和角度如何。

## 功能特点

- 支持任意角度的手机模板
- 交互式选择手机屏幕区域
- 保存屏幕角点坐标以供重复使用
- 处理单个或多个手机屏幕的模板
- 高质量透视变换以确保自然效果
- 简单的命令行界面

## 设计思路

该工具的核心是使用计算机视觉技术将二维图像（App截图）映射到三维空间中的平面（手机屏幕）。这个过程包括以下几个关键步骤：

1. **定位手机屏幕**：通过手动选择屏幕的四个角点来定义屏幕区域
2. **计算透视变换**：根据原始截图和目标屏幕的几何关系计算变换矩阵
3. **应用变换**：将截图变形以匹配屏幕的角度和透视效果
4. **融合图像**：使用掩码将变换后的截图无缝融合到原始模板中

## 技术实现

### 关键算法

1. **透视变换**：使用OpenCV的`getPerspectiveTransform`和`warpPerspective`函数将平面图像映射到透视空间
2. **掩码处理**：使用凸多边形填充创建精确的掩码，确保只替换手机屏幕区域
3. **图像融合**：使用位运算和掩码技术将变换后的截图与原始模板无缝融合

### 主要函数

1. `overlay_screenshot(template, screenshot, corners)`
   - 核心函数，负责执行透视变换和图像融合
   - 接受模板图像、截图路径和屏幕角点坐标作为输入
   - 返回处理后的图像

2. `interactive_select_corners(image_path, num_screens)`
   - 允许用户通过鼠标点击在模板图像上选择手机屏幕的角点
   - 支持选择多个屏幕的角点
   - 返回所有屏幕的角点坐标列表

3. `save_corners(corners, filename)` 和 `load_corners(filename)`
   - 将角点坐标保存到JSON文件或从文件加载角点坐标
   - 便于重复使用相同的模板图像

## 使用方法

### 基本用法

首次使用时，您需要选择手机屏幕的角点：

```bash
python main.py template.jpg screenshot.jpg -s -o result.jpg
```

这将打开一个窗口让您选择模板图像中手机屏幕的四个角点。点击顺序应为：左上、右上、右下、左下。

### 使用保存的角点

一旦保存了角点坐标，您可以重复使用它们处理多个截图：

```bash
python main.py template.jpg new_screenshot.jpg -c template_corners.json -o new_result.jpg
```

### 处理多个屏幕

对于含有多个手机的模板图像：

```bash
python main.py template.jpg screenshot1.jpg screenshot2.jpg -n 2 -s -o result.jpg
```

## 参数说明

- `template`：手机模板图片路径（必需）
- `screenshots`：一个或多个App截图路径（必需）
- `-o, --output`：输出图片路径（默认：result.jpg）
- `-c, --corners`：包含角点坐标的JSON文件（可选）
- `-s, --select`：启用交互式选择屏幕角点（可选）
- `-n, --num-screens`：模板中手机屏幕的数量（默认：1）

## 提示与技巧

1. **角点选择**：选择角点时，尽量精确定位到屏幕的实际边角，这将影响最终效果的质量
2. **截图尺寸**：为获得最佳效果，使用分辨率较高的App截图
3. **预处理模板**：使用质量高、光线均匀的模板图片，避免强烈的反光或阴影
4. **多屏处理**：处理多个屏幕时，按照从左到右的顺序提供截图

## 技术要求

- Python 3.6+
- OpenCV (`cv2`)
- NumPy
- argparse

## 注意事项

- 在交互式选择角点时，按ESC键可以提前退出
- 确保角点选择的顺序正确：左上、右上、右下、左下
- 为获得最佳效果，模板图片和截图的分辨率应该足够高

## 实例展示

此工具可用于创建产品演示图片、应用宣传材料或UI/UX设计展示。
